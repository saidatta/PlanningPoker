!function(a,b,c){"use-strict";b.module("ATS.SharedServices",["ngCookies","firebase"])}(window,window.angular),function(a,b,c){"use-strict";var d=new Firebase("https://sweltering-torch-73.firebaseio.com/");b.module("ATS.SharedServices").service("FirebaseService",["$q","$cookieStore","$firebaseObject",function(a,c,e){this.checkIfRoomExists=function(b){var c=a.defer();return d.child("rooms").child(b).once("value",function(a){exists=null!==a.val(),c.resolve(exists)}),c.promise},this.destroyRoom=function(a){d.child("rooms").child(a).remove()},this.destroyUser=function(a,b){d.child("rooms").child(a).child("users").child(b).remove()},this.generateRoomId=function(){return Math.floor(999e5*Math.random()+1e5).toString()},this.generateUserId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})},this.getRoom=function(a){var b=d.child("rooms").child(a);return e(b)},this.getUser=function(a,b){var c=d.child("rooms").child(a).child("users").child(b);return e(c)},this.newRoom=function(a){var f=e(d.child("rooms").child(a)),g=c.get("deckIndex");g||(g=0);var h=c.get("deck");h||(h={name:"Custom Deck",type:"nominal",cards:[]}),b.extend(f,{customDeck:h,deckIndex:g,reveal:!1,updatedAt:Firebase.ServerValue.TIMESTAMP}),f.$save()},this.newUser=function(a,c,f){var g=e(d.child("rooms").child(a).child("users").child(c));b.extend(g,{leader:f,vote:null,voter:!0}),g.$save()}}])}(window,window.angular),function(a,b,c){"use-strict";b.module("ATS.Landing",["ATS.SharedServices"])}(window,window.angular),function(a,b,c){"use-strict";b.module("ATS.Landing").controller("LandingController",["$rootScope","$scope","$location","$firebase","FirebaseService",function(a,b,c,d,e){b.joinRoom=function(){c.path("/"+b.roomId)},b.newRoom=function(){var b=e.generateRoomId();e.newRoom(b);var d=e.generateUserId(),f=!0;e.newUser(b,d,f),a.uuid=d,c.path("/"+b)}}])}(window,window.angular),function(a,b,c){"use-strict";b.module("ATS.Room",["ATS.SharedServices"])}(window,window.angular),function(a,b,c){"use-strict";b.module("ATS.Room").service("ResultsService",function(){this.calculateVoteCompletion=function(a){var c=0,d=0;return b.forEach(a,function(a,b){a.voter&&(d++,a.vote&&c++)}),d?100*c/d:0},this.getConsensusLevel=function(a,b){return 1!==a.length?"Tie":1===b?"Unanimous":b>=.75?"Consensus":b>=.5?"Majority":"Plurality"},this.getMedianVote=function(a){var b=this.mapVotesOrdinal(a);return 0===b.length?[]:b.length%2===0?[b[b.length/2]]:[b[Math.floor(b.length/2)]]},this.getResults=function(a,b){return"ordinal"===b.type?this.getResultsOrdinal(a):this.getResultsNominal(a)},this.getResultsNominal=function(a){var c=this.mapVotesNominal(a),d=0,e=[],f=0;return b.forEach(c,function(a,b){d+=a.count,a.count>f?(e=[a.card],f=a.count):a.count===f&&e.push(a.card)}),{consensusLevel:this.getConsensusLevel(e,f/d),cards:e}},this.getResultsOrdinal=function(a){return{consensusLevel:"Best Guess (Median)",cards:this.getMedianVote(a)}},this.mapVotesNominal=function(a){var c={};return b.forEach(a,function(a,b){a.vote&&(c[a.vote.text]?c[a.vote.text].count++:c[a.vote.text]={card:a.vote,count:1})}),c},this.mapVotesOrdinal=function(a){var c=[];return b.forEach(a,function(a,b){a.vote&&a.vote.val>=0&&c.push(a.vote)}),c.sort(function(a,b){return a.val<=b.val?-1:1}),c}})}(window,window.angular),function(a,b,c){"use-strict";b.module("ATS.Room").factory("DeckFactory",function(){return{getDecks:function(){return[{name:"Mountain Goat",type:"ordinal",cards:[{text:"0",val:0},{text:".5",val:.5},{text:"1",val:1},{text:"2",val:2},{text:"3",val:3},{text:"5",val:5},{text:"8",val:8},{text:"13",val:13},{text:"20",val:20},{text:"40",val:40},{text:"100",val:100},{text:"?",val:-1},{text:"coffee",val:-2,fa:"coffee"}]},{name:"Fibonacci",type:"ordinal",cards:[{text:"0",val:0},{text:"1",val:1},{text:"2",val:2},{text:"3",val:3},{text:"5",val:5},{text:"8",val:8},{text:"13",val:13},{text:"21",val:21},{text:"34",val:34},{text:"55",val:55},{text:"89",val:89},{text:"?",val:-1},{text:"coffee",val:-2,fa:"coffee"}]},{name:"Sequential",type:"ordinal",cards:[{text:"0",val:0},{text:"1",val:1},{text:"2",val:2},{text:"3",val:3},{text:"4",val:4},{text:"5",val:5},{text:"6",val:6},{text:"7",val:7},{text:"8",val:8},{text:"9",val:9},{text:"10",val:10},{text:"?",val:-1},{text:"coffee",val:-2,fa:"coffee"}]},{name:"T-Shirt",type:"ordinal",cards:[{text:"XS",val:1},{text:"S",val:2},{text:"M",val:3},{text:"L",val:4},{text:"XL",val:5},{text:"?",val:-1},{text:"coffee",val:-2,fa:"coffee"}]}]}}})}(window,window.angular),function(a,b,c){"use-strict";var d=15;b.module("ATS.Room").controller("DeckController",["$scope","$mdDialog","deck",function(a,c,e){function f(a){var c=[];return b.forEach(a.cards,function(a,d){c.push({text:a.text,val:b.isNumber(a.text)?Float.valueOf(a.text):d,fa:""})}),a.cards=c,a}a.deck=e,a.addCard=function(){a.deck.cards=a.deck.cards||[],a.deck.cards.length<d&&a.deck.cards.push({text:"NewCard"+(a.deck.cards.length+1).toString(),val:-1,fa:""})},a.canAddCard=function(){return!a.deck.cards||a.deck.cards.length<d},a.cancel=function(){c.cancel()},a.hasCards=function(){return a.deck.cards&&a.deck.cards.length>0},a.remove=function(b){var c=a.deck.cards.indexOf(b);a.deck.cards.splice(c,1)},a.save=function(){c.hide(f(a.deck))}}])}(window,window.angular),function(a,b,c){"use-strict";new Firebase("https://sweltering-torch-73.firebaseio.com/");b.module("ATS.Room").controller("RoomController",["$rootScope","$scope","$routeParams","$location","$cookieStore","FirebaseService","ResultsService","DeckFactory","$mdDialog",function(c,d,e,f,g,h,i,j,k){function l(){for(var a in d.room.users)d.room.users[a].vote=null;d.room.reveal=!1,d.room.results=null}function m(){d.user.leader?h.destroyRoom(d.room.$id):h.destroyUser(d.room.$id,d.user.$id),c.uuid=null}d.changeDeck=function(){l(),d.room.updatedAt=Firebase.ServerValue.TIMESTAMP,d.room.$save().then(function(){g.put("deckIndex",d.room.deckIndex)})},d.chooseCard=function(a,b,c){d.user.voter&&(d.user.vote&&d.user.vote.val===a?d.user.vote=null:d.user.vote={val:a,text:b,fa:c||""},d.user.$save())},d.deckIsEmpty=function(){return!d.selectedDeck||!d.selectedDeck.cards||0===d.selectedDeck.cards.length},d.editDeck=function(a){document.getElementById("edit").blur(),k.show({controller:"DeckController",clickOutsideToClose:!1,escapeToClose:!1,locals:{deck:b.copy(d.room.customDeck)},templateUrl:"modules/room/deck-editor.html",targetEvent:a,onComplete:function(){document.getElementById("name").focus()}}).then(function(a){l(),d.room.customDeck=a,d.selectedDeck=a,d.room.updatedAt=Firebase.ServerValue.TIMESTAMP,d.room.$save().then(function(){g.put("deck",a)})})},d.reset=function(){l(),d.room.updatedAt=Firebase.ServerValue.TIMESTAMP,d.room.$save(),document.getElementById("reset").blur()},d.reveal=function(){d.room.results=i.getResults(d.room.users,d.selectedDeck),d.room.reveal=!0,d.room.updatedAt=Firebase.ServerValue.TIMESTAMP,d.room.$save(),document.getElementById("reveal").blur()},d.share=function(){document.getElementById("share").blur(),a.prompt("Invite others to the room by sharing this link:",a.location)},d.toggleVoter=function(){d.user.$save()},d.$watch("room.customDeck",function(){-1===d.room.deckIndex&&(d.selectedDeck=d.room.customDeck)}),d.$watch("room.deckIndex",function(){var a=d.room.deckIndex;-1===a?d.selectedDeck=d.room.customDeck:d.selectedDeck=d.cardDecks[a]}),d.$watch("room.users",function(){d.voteCompletion=i.calculateVoteCompletion(d.room.users)});var n=e.roomId,o=c.uuid;h.checkIfRoomExists(n).then(function(a){if(a){if(d.room=h.getRoom(n),!o){o=h.generateUserId();var b=!1;h.newUser(n,o,b)}d.user=h.getUser(n,o),d.cardDecks=j.getDecks(),d.voteCompletion=0,d.room.$loaded(function(a){d.selectedDeck=d.cardDecks[a.deckIndex].cards})}else f.path("/")}),d.$on("$locationChangeStart",function(a,b,c){m()}),a.onbeforeunload=function(a){m()},d.$on("$destroy",function(){delete a.onbeforeunload})}])}(window,window.angular),function(a,b,c){"use-strict";b.module("ATS",["ngRoute","ngMaterial","ATS.Landing","ATS.Room"]).config(["$mdThemingProvider",function(a){a.theme("default").primaryPalette("blue").accentPalette("grey")}]).config(["$routeProvider",function(a){a.when("/",{controller:"LandingController",templateUrl:"modules/landing/landing.html"}).when("/contributors",{controller:"ContributorController",templateUrl:"modules/contributor/contributor.html"}).when("/:roomId/",{controller:"RoomController",templateUrl:"modules/room/room.html"}).otherwise({redirectTo:"/"})}])}(window,window.angular);